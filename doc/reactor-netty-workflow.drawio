<mxfile host="Electron" modified="2023-09-16T14:20:32.028Z" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.6.5 Chrome/114.0.5735.243 Electron/25.3.1 Safari/537.36" etag="JS-Opecd4U44dPSii_-U" version="21.6.5" type="device">
  <diagram name="第 1 页" id="SFu54w4d0Ybn-GLYL5bF">
    <mxGraphModel dx="3915" dy="879" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="uSWqA2PRX45ugPRLn6LA-1" value="&lt;p style=&quot;line-height: 1; font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;h1 style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;Reactor-Netty 工作原理&lt;/font&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp;&lt;/font&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;(v0.9.1)&amp;nbsp;&lt;br style=&quot;&quot;&gt;&lt;/font&gt;&lt;/font&gt;&lt;/h1&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;结合ProjectReactor将Netty封装成了响应式的通信框架。&lt;/font&gt;&lt;/div&gt;&lt;p style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;前提：&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;ul style=&quot;font-size: 10px;&quot;&gt;&lt;li style=&quot;font-size: 10px;&quot;&gt;熟悉 reactor-core、netty 实现原理和使用 （参考对应流程图）&lt;/li&gt;&lt;/ul&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;#说明：&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;ul style=&quot;font-size: 10px;&quot;&gt;&lt;li style=&quot;font-size: 10px;&quot;&gt;这里研究Reactor-Netty是怎么封装Netty和HTTP协议的， 以官方单元测试 HttpServerTests#releaseInboundChannelOnNonKeepAliveRequest() 为例&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;p style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="10" y="10" width="810" height="150" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-4" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-2" target="uSWqA2PRX45ugPRLn6LA-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-16" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-2" target="uSWqA2PRX45ugPRLn6LA-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-2" value="HttpServer 初始化&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;返回经多多层装饰后的HttpServer对象&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;gradientColor=#97d077;" parent="1" vertex="1">
          <mxGeometry x="40" y="200" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-6" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-3" target="uSWqA2PRX45ugPRLn6LA-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-44" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-3" target="uSWqA2PRX45ugPRLn6LA-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-3" value=".create()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;主要是创建TcpServer并设置基本选项&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="240" y="200" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-8" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-5" target="uSWqA2PRX45ugPRLn6LA-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-65" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-5" target="uSWqA2PRX45ugPRLn6LA-64" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-5" value=".port(8080)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="240" y="360" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-10" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-7" target="uSWqA2PRX45ugPRLn6LA-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-71" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-7" target="uSWqA2PRX45ugPRLn6LA-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-7" value=".handle((req, resp) -&amp;gt; req.receive()&lt;br&gt;.then(resp.status(200).send()))&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;装配请求处理器方法（请求处理入口）&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="240" y="440" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-75" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-9" target="uSWqA2PRX45ugPRLn6LA-74" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-9" value=".wiretap(true)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;开启wire logger&lt;br&gt;由后面的实现可以看到是注册了一个ChannelHandler实现日志记录的&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="240" y="520" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-81" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-11" target="uSWqA2PRX45ugPRLn6LA-80" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-11" value=".bindNow()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;返回 DisposableServer 对象&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="240" y="722" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-31" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="uSWqA2PRX45ugPRLn6LA-13" target="bm2imlQ028U47hNO7TBu-30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-13" value="Mono.when(&lt;br&gt;disposableServer.onDispose())&lt;br&gt;.block();" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="240" y="881" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-18" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-15" target="uSWqA2PRX45ugPRLn6LA-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-19" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-15" target="uSWqA2PRX45ugPRLn6LA-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-15" value="HttpServer 启动,&lt;br&gt;绑定端口并等待绑定完成" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;gradientColor=#97d077;" parent="1" vertex="1">
          <mxGeometry x="40" y="722" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-20" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-17" target="uSWqA2PRX45ugPRLn6LA-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-23" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="uSWqA2PRX45ugPRLn6LA-17" target="bm2imlQ028U47hNO7TBu-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-17" value="HttpServer 阻塞等待服务关闭" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;gradientColor=#97d077;" parent="1" vertex="1">
          <mxGeometry x="40" y="881" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-21" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.http.server&lt;font style=&quot;background-color: initial; font-size: 10px;&quot;&gt;.&lt;/font&gt;&lt;/font&gt;&lt;b style=&quot;color: rgb(0, 0, 0); background-color: initial; font-size: 10px;&quot;&gt;HttpServer&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;reator-netty HTTP服务器抽象实现类&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;//核心基于 TcpServer, 这里是默认实现&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;static final TcpServer &lt;b style=&quot;font-size: 10px;&quot;&gt;DEFAULT_TCP_SERVER&lt;/b&gt; = TcpServer.create();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//下面是 TcpServer 属性配置的函数式方法&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;color: rgb(0, 0, 0); background-color: initial; font-size: 10px;&quot;&gt;static final Function&amp;lt;TcpServer, TcpServer&amp;gt; &lt;/span&gt;&lt;b style=&quot;color: rgb(0, 0, 0); background-color: initial; font-size: 10px;&quot;&gt;COMPRESS_ATTR_CONFIG&lt;/b&gt;&lt;span style=&quot;color: rgb(0, 0, 0); background-color: initial; font-size: 10px;&quot;&gt; = (tcp) -&amp;gt; {&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&amp;nbsp; &amp;nbsp; return tcp.bootstrap(HttpServerConfiguration.MAP_COMPRESS);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;};&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;static final Function&amp;lt;TcpServer, TcpServer&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;COMPRESS_ATTR_DISABLE&lt;/b&gt; = (tcp) -&amp;gt; {&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&amp;nbsp; &amp;nbsp; return tcp.bootstrap(HttpServerConfiguration.MAP_NO_COMPRESS);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;};&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;static final Function&amp;lt;TcpServer, TcpServer&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;FORWARD_ATTR_CONFIG&lt;/b&gt; = (tcp) -&amp;gt; {&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&amp;nbsp; &amp;nbsp; return tcp.bootstrap(HttpServerConfiguration.MAP_FORWARDED);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;};&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;static final Function&amp;lt;TcpServer, TcpServer&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;FORWARD_ATTR_DISABLE&lt;/b&gt; = (tcp) -&amp;gt; {&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&amp;nbsp; &amp;nbsp; return tcp.bootstrap(HttpServerConfiguration.MAP_NO_FORWARDED);&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;};&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="-960" y="200" width="480" height="260" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-22" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-23" target="uSWqA2PRX45ugPRLn6LA-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-23" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.http.server&lt;font style=&quot;background-color: initial; font-size: 10px;&quot;&gt;.&lt;/font&gt;&lt;b style=&quot;background-color: initial; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;HttpServerBind&lt;/font&gt;&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;HttpServer的具体实现，单例模式对象 TcpServerBind.INSTANCE&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;static final HttpServerBind &lt;b style=&quot;font-size: 10px;&quot;&gt;INSTANCE&lt;/b&gt; = new HttpServerBind();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;static final Function&amp;lt;DisposableServer, DisposableServer&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;CLEANUP_GLOBAL_RESOURCE&lt;/b&gt; =&amp;nbsp;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;span style=&quot;white-space: pre; font-size: 10px;&quot;&gt;&#x9;&lt;/span&gt;DisposableBind::new;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//实际使用的TcpServer对象，如果构造方法没有传参就默认使用 DEFAULT_TCP_SERVER&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final TcpServer &lt;b style=&quot;font-size: 10px;&quot;&gt;tcpServer&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-960" y="494" width="480" height="126" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-24" style="orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=diamondThin;endFill=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-25" target="uSWqA2PRX45ugPRLn6LA-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-25" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.tcp.&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 0, 0); background-color: initial; font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;TcpServer&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;reactor-netty Tcp服务器抽象实现类&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px;&quot;&gt;static final int &lt;b style=&quot;font-size: 10px;&quot;&gt;DEFAULT_PORT&lt;/b&gt; = 0;&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;&quot;&gt;static final LoggingHandler &lt;b&gt;LOGGING_HANDLER&lt;/b&gt; =&amp;nbsp;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;new LoggingHandler(TcpServer.class);&lt;br&gt;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="-1400" y="200" width="400" height="120" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-26" style="orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-27" target="uSWqA2PRX45ugPRLn6LA-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-27" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px;&quot;&gt;reactor.netty.tcp.&lt;b style=&quot;font-size: 10px;&quot;&gt;Tcp&lt;/b&gt;&lt;/font&gt;&lt;b style=&quot;font-size: 10px; color: rgb(0, 0, 0); background-color: initial;&quot;&gt;ServerBind&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;TcpServer的具体实现，单例模式对象TcpServerBind.INSTANCE&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;同时实现了 Function&amp;lt;ServerBootStrap, ServerBootstrap&amp;gt; 接口，用于定义初始化&lt;br style=&quot;font-size: 10px;&quot;&gt;方法&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px;&quot;&gt;static final TcpServerBind &lt;b style=&quot;font-size: 10px;&quot;&gt;INSTANCE&lt;/b&gt; = new TcpServerBind();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;//Netty的服务端实例&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;final &lt;b style=&quot;font-size: 10px;&quot;&gt;ServerBootstrap&lt;/b&gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;serverBootstrap&lt;/b&gt; = this.createServerBootstrap();&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1400" y="494" width="400" height="126" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-28" style="orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeColor=none;endArrow=block;endFill=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-30" target="uSWqA2PRX45ugPRLn6LA-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-29" style="orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-30" target="uSWqA2PRX45ugPRLn6LA-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-30" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.tcp.&lt;/font&gt;&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 0, 0); background-color: initial; font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;TcpServerOperator&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;用于通过装饰器模式拓展功能&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//被装饰的TcpServer实例&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px;&quot;&gt;final TcpServer source;&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1780" y="494" width="320" height="105" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-31" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-32" target="uSWqA2PRX45ugPRLn6LA-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-32" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.tcp.&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;span style=&quot;background-color: initial; font-size: 10px;&quot;&gt;&lt;b style=&quot;color: rgb(0, 0, 0); font-size: 10px;&quot;&gt;TcpServerBootstrap &lt;/b&gt;（这里是&lt;b style=&quot;font-size: 10px;&quot;&gt;装饰器模式&lt;/b&gt;）&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//用于装配TCP服务器配置的函数式方法，每装饰一层注册一个方法&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final Function&amp;lt;? super ServerBootstrap, ? extends ServerBootstrap&amp;gt; &lt;b&gt;bootstrapMapper&lt;/b&gt;;&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-1840" y="641" width="440" height="79" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-33" style="orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;endArrow=block;endFill=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-34" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-720.0000000000005" y="460" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-34" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px;&quot;&gt;reactor.netty.http.server.&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 0, 0); background-color: initial; font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;HttpServerOperator&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;border-color: var(--border-color); margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;通过&lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;装饰器模式&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;装配上 &lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;TCP配置&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;、&lt;/span&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;请求处理器&lt;/b&gt;&lt;span style=&quot;background-color: initial;&quot;&gt; 等组件&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px;&quot;&gt;final HttpServer&amp;nbsp;source; &lt;/font&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//被装饰的HttpServer实例&lt;/font&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-440" y="494" width="360" height="105" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-35" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-36" target="uSWqA2PRX45ugPRLn6LA-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-36" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px;&quot;&gt;reactor.netty.http.server&lt;/font&gt;&lt;font style=&quot;background-color: initial; font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px;&quot;&gt;.&lt;/font&gt;&lt;/font&gt;&lt;span style=&quot;background-color: initial; font-size: 10px;&quot;&gt;&lt;font color=&quot;#000000&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;HttpServerTcpConfig&lt;/b&gt;&lt;/font&gt;&lt;b style=&quot;color: rgb(0, 0, 0); font-size: 10px;&quot;&gt;&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;（&lt;/span&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;装饰器模式&lt;/b&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;）&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;用于装配TCP配置信息(比如：端口、wire logger)&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//设置端口、wire logger等配置的函数方法&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;f&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 0, 0); background-color: initial;&quot;&gt;inal Function&amp;lt;? super ServerBootstrap, ? extends ServerBootstrap&amp;gt; &lt;b&gt;bootstrapMapper&lt;/b&gt;;&lt;/span&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-480" y="660" width="440" height="100" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-39" style="orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=block;endFill=1;fontSize=10;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-40" target="uSWqA2PRX45ugPRLn6LA-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-40" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.http.server&lt;/font&gt;&lt;font style=&quot;background-color: initial; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;/font&gt;&lt;span style=&quot;background-color: initial; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;HttpServerHandle&lt;/b&gt;&lt;/font&gt;&lt;b style=&quot;color: rgb(0, 0, 0); font-size: 10px;&quot;&gt;&amp;nbsp;&lt;/b&gt;（&lt;b style=&quot;font-size: 10px;&quot;&gt;装饰器模式&lt;/b&gt;）&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;用于装配处理器逻辑&lt;br&gt;&lt;br&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;/p&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//处理请求的函数方法，它作为业务处理入口&lt;/font&gt;&lt;span style=&quot;font-size: 10px; color: rgb(0, 0, 0); background-color: initial;&quot;&gt;&lt;br&gt;final BiFunction&amp;lt;? super HttpServerRequest, ? super&lt;/span&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;HttpServerResponse, ? extends Publisher&amp;lt;Void&amp;gt;&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;handler&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-960" y="661" width="440" height="99" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-41" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.resources&lt;/font&gt;&lt;font style=&quot;background-color: initial; font-size: 10px;&quot; color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;b style=&quot;color: rgb(0, 0, 0); background-color: initial; font-size: 10px;&quot;&gt;DefaultLoopResources&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;用于客户端和服务端创建并缓存EventLoopGroup(一组线程)的，&lt;br style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;可以当作EventLoopGroup的工厂+管理器&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//线程名前缀&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final String&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b style=&quot;font-size: 10px;&quot;&gt;prefix&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//是否是守护线程&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final boolean&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b style=&quot;font-size: 10px;&quot;&gt;daemon&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//selector线程（即boss线程，分发请求）数量&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final int&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b style=&quot;font-size: 10px;&quot;&gt;selectCount&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//工作线程（处理请求）数量&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final int&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b style=&quot;font-size: 10px;&quot;&gt;workerCount&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//这三组功能同后面的三组EventLoopGroup,只是基于 &lt;b style=&quot;font-size: 10px;&quot;&gt;NioEventLoopGroup&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b style=&quot;font-size: 10px;&quot;&gt;//后面三组基于 projectreactor DefaultLoopEpoll，&lt;/b&gt;不过记得本质都是一样的，底层都是epoll,&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;只是封装不同, 默认用 useNative = true, 即用DefaultLoopEpoll&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final AtomicReference&amp;lt;EventLoopGroup&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;serverLoops&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final AtomicReference&amp;lt;EventLoopGroup&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;clientLoops&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final AtomicReference&amp;lt;EventLoopGroup&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;serverSelectLoops&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//客户端线程组（并不等同于连接线程）&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final AtomicReference&amp;lt;EventLoopGroup&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;cacheNativeClientLoops&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//服务端worker线程组，默认情况下和boss线程组是同一组线程，&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//调试可以发现和下面的cacheNativeSelectLoops中的线程组是同一个对象&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final AtomicReference&amp;lt;EventLoopGroup&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;cacheNativeServerLoops&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;//服务端Selector(boss)线程组&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final AtomicReference&amp;lt;EventLoopGroup&amp;gt; &lt;b style=&quot;font-size: 10px;&quot;&gt;cacheNativeSelectLoops&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;final AtomicBoolean&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;running;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-480" y="801" width="440" height="360" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-42" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;Reactor-Netty提供了HTTP TCP UDP &lt;br&gt;三种CS实现，这里主要分析HTTP， &lt;br&gt;不过HTTP服务器是基于TCP服务器实现的&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="40" y="260" width="210" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-46" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-43" target="uSWqA2PRX45ugPRLn6LA-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-48" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-43" target="uSWqA2PRX45ugPRLn6LA-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-97" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-47" target="uSWqA2PRX45ugPRLn6LA-93" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="900" y="245" />
              <mxPoint x="900" y="737" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-43" value="HttpServerBind INSTANCE = new &lt;b&gt;HttpServerBind&lt;/b&gt;();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="440" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-45" value="return HttpServerBind.INSTANCE;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="440" y="280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-51" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-47" target="uSWqA2PRX45ugPRLn6LA-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-53" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-47" target="uSWqA2PRX45ugPRLn6LA-52" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-47" value="TcpServer.create();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="680" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-49" value="HttpServerBind" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="490" y="170" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-50" value="return TcpServerBind.INSTANCE;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="680" y="280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-56" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-52" target="uSWqA2PRX45ugPRLn6LA-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-52" value="TcpServerBind INSTANCE = new TcpServerBind();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="920" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-54" value="TcpServerBind" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="970" y="170" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-58" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-55" target="uSWqA2PRX45ugPRLn6LA-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-60" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-55" target="uSWqA2PRX45ugPRLn6LA-59" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-55" value="this.serverBootstrap = createServerBootstrap();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1160" y="200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-62" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-57" target="uSWqA2PRX45ugPRLn6LA-61" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-57" value="BootstrapHandlers.channelOperationFactory(&lt;br&gt;this.&lt;b&gt;serverBootstrap&lt;/b&gt;, TcpUtils.&lt;b&gt;TCP_OPS&lt;/b&gt;);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1160" y="280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-59" value="&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;return new ServerBootstrap()&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;.option(ChannelOption.SO_REUSEADDR, true)&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;.childOption(ChannelOption.AUTO_READ, false)&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;.childOption(ChannelOption.TCP_NODELAY, true)&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 9px;&quot;&gt;&lt;font style=&quot;font-size: 9px;&quot;&gt;.localAddress(newInetSocketAddress(DEFAULT_PORT));&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=12;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1400" y="200" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-61" value="b.&lt;b&gt;option&lt;/b&gt;(OPS_OPTION, opsFactory);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;OPS_OPTION是拓展的选项，并不是Netty本身定义的&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1400" y="280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-63" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;这里的选项对应套接字选项，参考UNIX网络编程C7.5&lt;br&gt;SO_REUSEADDR：主要是为了支持已存在连接的情况下重启服务器，其他3种功能参考Markdown文档&lt;br&gt;TCP_NODELAY: 开启会禁止TCP的Nagle算法，确保响应不会因为存在待确认数据（就是响应还没发回就收到新的数据）而出现延迟&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1650" y="200" width="610" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-67" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-64" target="uSWqA2PRX45ugPRLn6LA-66" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-64" value="return tcpConfiguration(tcpServer -&amp;gt; tcpServer.port(port));" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="440" y="360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-69" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-66" target="uSWqA2PRX45ugPRLn6LA-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-66" value="return new &lt;b&gt;HttpServerTcpConfig&lt;/b&gt;(this, tcpMapper);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;HttpServerTcpConfig是装配配置方法后的&lt;br&gt;HttpServer&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="680" y="360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-107" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-68" target="uSWqA2PRX45ugPRLn6LA-106" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-68" value="tcpServer.port(port)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;绑定阶段被调用&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="920" y="360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-73" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-70" target="uSWqA2PRX45ugPRLn6LA-72" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-70" value="return new &lt;b&gt;HttpServerHandle&lt;/b&gt;(this, handler);&lt;br&gt;&lt;b style=&quot;border-color: var(--border-color);&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;HttpServerHandle&lt;span style=&quot;background-color: initial; font-weight: normal;&quot;&gt;是装配请求处理方法后的&lt;/span&gt;&lt;br&gt;&lt;/font&gt;&lt;/b&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;HttpServer&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="440" y="440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-72" value="(req, resp) -&amp;gt; resp.sendNotFound()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;处理请求阶段被调用&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="680" y="440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-77" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-74" target="uSWqA2PRX45ugPRLn6LA-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-74" value="&lt;div&gt;return tcpConfiguration(tcpServer -&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tcpServer.bootstrap(b -&amp;gt; BootstrapHandlers.updateLogSupport(b, LOGGING_HANDLER)));&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="440" y="520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-79" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-76" target="uSWqA2PRX45ugPRLn6LA-78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-76" value="return new HttpServerTcpConfig(this, tcpMapper);&lt;br&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;HttpServerTcpConfig是装配配置方法后的&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;HttpServer，这一步装配了wire logger 函数方法&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="680" y="520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-109" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-78" target="uSWqA2PRX45ugPRLn6LA-108" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-78" value="&lt;div&gt;tcpServer -&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; tcpServer.bootstrap(b -&amp;gt; BootstrapHandlers.updateLogSupport(b, LOGGING_HANDLER))&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="920" y="520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-83" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-80" target="uSWqA2PRX45ugPRLn6LA-82" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-80" value="bindNow(Duration.ofSeconds(45));&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;默认绑定超时时间45s&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="440" y="722" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-85" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-82" target="uSWqA2PRX45ugPRLn6LA-84" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-94" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-82" target="uSWqA2PRX45ugPRLn6LA-93" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-82" value="bind()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;返回Mono&amp;lt;DisposableServer&amp;gt;对象&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="680" y="722" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-84" value=".block(timeout)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;阻塞等待Mono接收到下一个信号（元素）（&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;TcpServerBind#&lt;b&gt;operationComplete&lt;/b&gt;()会发送信号&lt;/font&gt;&lt;font color=&quot;#007fff&quot;&gt;）&lt;/font&gt;&lt;font style=&quot;border-color: var(--border-color);&quot; color=&quot;#007fff&quot;&gt;即&lt;/font&gt;&lt;font style=&quot;border-color: var(--border-color);&quot; color=&quot;#007fff&quot;&gt;等待HttpServer bind 成功或失败&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="680" y="801" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-91" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-88" target="uSWqA2PRX45ugPRLn6LA-90" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-88" value="return source.bind(b)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;层层深入最终调用HttpServerBind的bind&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1160" y="801" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-112" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-90" target="uSWqA2PRX45ugPRLn6LA-111" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-116" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-90" target="uSWqA2PRX45ugPRLn6LA-115" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-90" value="bootstrap(this)&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;装配HttpServerBind#apply()&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1400" y="801" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-92" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;HttpServer装配后的实际对象：&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;this = {&lt;b&gt;HttpServerTcpConfig&lt;/b&gt;@2224}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;tcpServerMapper = {HttpServer$lambda@2225}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;source = {&lt;b&gt;HttpServerHandle&lt;/b&gt;@2226}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; handler = {HttpServerTests$lambda@2218}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; source = {&lt;b&gt;HttpServerTcpConfig&lt;/b&gt;@2217}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp;tcpServerMapper = {HttpServer$lambda@2219}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp;source = {&lt;b&gt;HttpServerBind&lt;/b&gt;@2220}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; tcpServer = {TcpServerBind@2180}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;serverBootstrap = {ServerBootstrap@2182}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;labelBorderColor=none;labelBackgroundColor=#E6E6E6;" parent="1" vertex="1">
          <mxGeometry x="910" y="796" width="250" height="130" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-100" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-93" target="uSWqA2PRX45ugPRLn6LA-99" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-93" value="return bind(tcpConfiguration());" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="920" y="722" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-101" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-99" target="uSWqA2PRX45ugPRLn6LA-78" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1370" y="752" />
              <mxPoint x="1370" y="710" />
              <mxPoint x="910" y="710" />
              <mxPoint x="910" y="565" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-103" value="1" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="uSWqA2PRX45ugPRLn6LA-101" vertex="1" connectable="0">
          <mxGeometry x="-0.8832" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-102" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-99" target="uSWqA2PRX45ugPRLn6LA-68" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1390" y="752" />
              <mxPoint x="1390" y="510" />
              <mxPoint x="910" y="510" />
              <mxPoint x="910" y="405" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-104" value="3" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="uSWqA2PRX45ugPRLn6LA-102" vertex="1" connectable="0">
          <mxGeometry x="-0.8751" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-105" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-99" target="uSWqA2PRX45ugPRLn6LA-88" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-214" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-99" target="uSWqA2PRX45ugPRLn6LA-72" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1380" y="752" />
              <mxPoint x="1380" y="600" />
              <mxPoint x="660" y="600" />
              <mxPoint x="660" y="485" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-215" value="2" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="uSWqA2PRX45ugPRLn6LA-214" vertex="1" connectable="0">
          <mxGeometry x="-0.8734" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-37" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="uSWqA2PRX45ugPRLn6LA-99" target="uSWqA2PRX45ugPRLn6LA-92">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-99" value="tcpServerMapper.apply(&lt;br&gt;source.tcpConfiguration())&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;层层深入调用tcpServerMapper函数式方法&lt;br&gt;对TcpServer进行装配&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1160" y="722" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-128" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-106" target="uSWqA2PRX45ugPRLn6LA-127" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-106" value="b -&amp;gt; TcpUtils.updatePort(b, port)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1160" y="360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-149" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-108" target="uSWqA2PRX45ugPRLn6LA-148" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-108" value="b -&amp;gt; BootstrapHandlers.updateLogSupport(b, &lt;b&gt;LOGGING_HANDLER&lt;/b&gt;)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1160" y="520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-110" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;TcpServer装配后的实际对象：&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;b = {TcpServerBootstrap@2244}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;bootstrapMapper = {HttpServer$lambda@2245}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;source = {TcpServerBootstrap@2242}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; bootstrapMapper = {HttpServerHandle@2234}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; source = {TcpServerBootstrap@2232}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp;bootstrapMapper = {TcpServer$lambda@2233}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp;source = {TcpServerBind@2180}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; serverBootstrap = {ServerBootstrap@2181}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;labelBackgroundColor=#E6E6E6;" parent="1" vertex="1">
          <mxGeometry x="1160" y="890" width="240" height="120" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-114" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-111" target="uSWqA2PRX45ugPRLn6LA-113" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-118" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-111" target="uSWqA2PRX45ugPRLn6LA-117" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-111" value="bind()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1400" y="881" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-113" value="map(CLEANUP_GLOBAL_RESOURCE)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1400" y="1040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-144" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-115" target="uSWqA2PRX45ugPRLn6LA-143" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2140" y="831" />
              <mxPoint x="2140" y="470" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-115" value="ServerBootstrap apply(ServerBootstrap b)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1640" y="801" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-121" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-117" target="uSWqA2PRX45ugPRLn6LA-120" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-123" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-117" target="uSWqA2PRX45ugPRLn6LA-122" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-117" value="b = configure();" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1640" y="881" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-119" value="TcpServer" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1700" y="860" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-176" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-120" target="uSWqA2PRX45ugPRLn6LA-175" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-120" value="return bind(b);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;此时b是经过层层装饰后的TcpServer对象&lt;br&gt;此方法会层层深入执行 TcpServerBind#bind&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1640" y="1040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-124" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-122" target="uSWqA2PRX45ugPRLn6LA-106" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2100" y="911" />
              <mxPoint x="2100" y="430" />
              <mxPoint x="1140" y="430" />
              <mxPoint x="1140" y="405" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-158" value="1" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="uSWqA2PRX45ugPRLn6LA-124" vertex="1" connectable="0">
          <mxGeometry x="-0.5046" y="-3" relative="1" as="geometry">
            <mxPoint x="-3" y="22" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-125" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-122" target="uSWqA2PRX45ugPRLn6LA-108" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2100" y="911" />
              <mxPoint x="2100" y="590" />
              <mxPoint x="1140" y="590" />
              <mxPoint x="1140" y="565" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-137" value="3" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="uSWqA2PRX45ugPRLn6LA-125" vertex="1" connectable="0">
          <mxGeometry x="-0.5921" y="-1" relative="1" as="geometry">
            <mxPoint x="-21" y="-76" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-126" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-122" target="uSWqA2PRX45ugPRLn6LA-115" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2100" y="911" />
              <mxPoint x="2100" y="871" />
              <mxPoint x="1620" y="871" />
              <mxPoint x="1620" y="846" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-138" value="4" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="uSWqA2PRX45ugPRLn6LA-126" vertex="1" connectable="0">
          <mxGeometry x="-0.7185" y="3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-132" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-122" target="uSWqA2PRX45ugPRLn6LA-129" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-134" value="2" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="uSWqA2PRX45ugPRLn6LA-132" vertex="1" connectable="0">
          <mxGeometry x="0.2167" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-38" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.608;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="uSWqA2PRX45ugPRLn6LA-122" target="uSWqA2PRX45ugPRLn6LA-110">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-122" value="bootstrapMapper.apply(source.configure()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;一层层地执行 bootstrapMapper, 先克隆TcpServer, 然后配置端口、ConnectionObserver、日志ChannelHandler、线程组、HTTP协议相关&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="1880" y="881" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-127" value="b.&lt;b&gt;localAddress&lt;/b&gt;(_updatePort(&lt;br&gt;b.config().localAddress(), port))" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1400" y="360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-131" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-129" target="uSWqA2PRX45ugPRLn6LA-130" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-129" value="HttpServerHandle#apply()" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2120" y="881" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-136" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-130" target="uSWqA2PRX45ugPRLn6LA-135" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-140" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-130" target="uSWqA2PRX45ugPRLn6LA-139" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-130" value="ConnectionObserver observer = BootstrapHandlers&lt;br&gt;.&lt;b&gt;childConnectionObserver&lt;/b&gt;(b);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;ConnectionObserver 是TCP连接生命周期的监听器&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2360" y="881" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-142" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-135" target="uSWqA2PRX45ugPRLn6LA-141" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-135" value="BootstrapHandlers.childConnectionObserver(&lt;br&gt;b, observer.then(this));&lt;br&gt;return b;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2360" y="961" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-201" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-139" target="uSWqA2PRX45ugPRLn6LA-182" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2580" y="931" />
              <mxPoint x="2580" y="1190" />
              <mxPoint x="2350" y="1190" />
              <mxPoint x="2350" y="1215" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-139" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;div&gt;ConnectionObserver obs = (ConnectionObserver) b.config()&lt;/div&gt;&lt;div&gt;&amp;nbsp; .childOptions()&lt;/div&gt;&lt;div&gt;&amp;nbsp; .get(&lt;b&gt;OBSERVER_OPTION&lt;/b&gt;);&lt;/div&gt;&lt;div&gt;if (obs == null) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; return ConnectionObserver.&lt;b&gt;emptyListener&lt;/b&gt;();&amp;nbsp;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;b.&lt;b&gt;childOption&lt;/b&gt;(&lt;b&gt;OBSERVER_OPTION&lt;/b&gt;, null);&lt;/div&gt;&lt;div&gt;return obs;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;align=left;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="2600" y="871" width="220" height="80" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-202" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-141" target="uSWqA2PRX45ugPRLn6LA-182" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2580" y="1006" />
              <mxPoint x="2580" y="1190" />
              <mxPoint x="2350" y="1190" />
              <mxPoint x="2350" y="1215" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-141" value="b.&lt;b&gt;childOption&lt;/b&gt;(&lt;b&gt;OBSERVER_OPTION&lt;/b&gt;, connectionObserver);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="2600" y="961" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-162" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-143" target="uSWqA2PRX45ugPRLn6LA-161" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-143" value="HttpServerConfiguration conf = HttpServerConfiguration.getAndClean(b);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2160" y="440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-151" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-148" target="uSWqA2PRX45ugPRLn6LA-150" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-148" value="c =&amp;nbsp;new &lt;b&gt;LoggingHandlerSupportConsumer&lt;/b&gt;(&lt;br&gt;handler, debugSsl);&lt;br&gt;b.&lt;b&gt;childHandler&lt;/b&gt;(updateConfiguration(&lt;br&gt;b.config().childHandler(), name, c));" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1400" y="520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-156" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-150" target="uSWqA2PRX45ugPRLn6LA-155" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-216" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;fillColor=#d5e8d4;strokeColor=#82b366;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-217" target="uSWqA2PRX45ugPRLn6LA-209" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2110" y="565" />
              <mxPoint x="2110" y="1430" />
              <mxPoint x="2340" y="1430" />
              <mxPoint x="2340" y="1455" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-218" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-150" target="uSWqA2PRX45ugPRLn6LA-217" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-150" value="&lt;b&gt;BootstrapPipelineHandler&lt;/b&gt; p = getOrCreateInitializer(handler);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;初始为空，这里会创建&amp;nbsp;BootstrapPipelineHandler&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1640" y="520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-155" value="p.&lt;b&gt;add&lt;/b&gt;(new PipelineConfiguration(c, name));&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;注册Pipeline Handler&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1640" y="601" width="200" height="59" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-160" value="BootstrapHandlers" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1440" y="490" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-164" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-161" target="uSWqA2PRX45ugPRLn6LA-163" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-161" value="conf.SSL配置" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2160" y="520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-166" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-163" target="uSWqA2PRX45ugPRLn6LA-165" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-170" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-163" target="uSWqA2PRX45ugPRLn6LA-169" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-163" value="线程组配置" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2160" y="599" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-168" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-165" target="uSWqA2PRX45ugPRLn6LA-167" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-172" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-165" target="uSWqA2PRX45ugPRLn6LA-171" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-165" value="BootstrapHandlers&lt;br&gt;.channelOperationFactory(b);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2160" y="680" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-174" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-167" target="uSWqA2PRX45ugPRLn6LA-173" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-167" value="HTTP协议相关配置&lt;br&gt;协议版本、解码器、压缩、cookie相关&lt;br&gt;支持多种版本协议，这里只关注h11" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2160" y="776" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-169" value="&lt;font style=&quot;font-size: 8px;&quot;&gt;LoopResources loops = HttpResources.get();&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;EventLoopGroup selector = loops.onServerSelect(LoopResources.DEFAULT_NATIVE);&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;EventLoopGroup elg = loops.onServer(LoopResources.DEFAULT_NATIVE);&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;b.&lt;b&gt;group&lt;/b&gt;(selector, elg).&lt;b&gt;channel&lt;/b&gt;(loops.onServerChannel(elg));&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=6;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="2400" y="589" width="320" height="81" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-171" value="b.option(OPS_OPTION, null);&lt;br&gt;return ops;&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;清除自定义选项&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="2400" y="680.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-173" value="&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;return BootstrapHandlers.&lt;b&gt;updateConfiguration&lt;/b&gt;(b,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; NettyPipeline.HttpInitializer,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; new Http1Initializer(conf.decoder.maxInitialLineLength(),&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.decoder.maxHeaderSize(),&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.decoder.maxChunkSize(),&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.decoder.validateHeaders(),&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.decoder.initialBufferSize(),&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.minCompressionSize,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; compressPredicate(conf.compressPredicate, conf.minCompressionSize),&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.forwarded,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.cookieEncoder,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 8px;&quot;&gt;&lt;font style=&quot;font-size: 8px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; conf.cookieDecoder));&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;arcSize=7;align=left;" parent="1" vertex="1">
          <mxGeometry x="2400" y="746" width="320" height="120" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-179" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-175" target="uSWqA2PRX45ugPRLn6LA-178" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-175" value="SSL相关，&lt;br&gt;其实就是往ChannelHandler 责任链中加入了SSL的处理，暂略" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1880" y="1040" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-177" value="TcpServerBind" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1930" y="1018" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-181" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-178" target="uSWqA2PRX45ugPRLn6LA-180" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-178" value="return Mono.&lt;b&gt;create&lt;/b&gt;(sink-&amp;gt;{...})&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;sink -&amp;gt; {} 定义序列生成逻辑，参考reactor-core的流程图&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="1880" y="1120" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-183" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-180" target="uSWqA2PRX45ugPRLn6LA-182" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-180" value="ServerBootstrap bootstrap = b.clone();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;又克隆了一次，为何不再原对象上操作，&lt;br&gt;哪里会复用么？&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2120" y="1120" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-185" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-182" target="uSWqA2PRX45ugPRLn6LA-184" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-204" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-182" target="uSWqA2PRX45ugPRLn6LA-203" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-182" value="&lt;div&gt;ConnectionObserver &lt;b&gt;obs&lt;/b&gt; = BootstrapHandlers&lt;/div&gt;&lt;div&gt;.&lt;b&gt;connectionObserver&lt;/b&gt;(bootstrap);&lt;/div&gt;&lt;div&gt;ConnectionObserver &lt;b&gt;childObs&lt;/b&gt; = BootstrapHandlers&lt;/div&gt;&lt;div&gt;.&lt;b&gt;childConnectionObserver&lt;/b&gt;(bootstrap);&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2100" y="1200" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-187" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-184" target="uSWqA2PRX45ugPRLn6LA-186" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-206" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-184" target="uSWqA2PRX45ugPRLn6LA-205" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-184" value="&lt;div&gt;ChannelOperations.OnSetup ops =&lt;/div&gt;&lt;div&gt;BootstrapHandlers&lt;br&gt;.&lt;b&gt;channelOperationFactory&lt;/b&gt;(bootstrap);&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;创建ChannelOperations工厂&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2120" y="1280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-189" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-186" target="uSWqA2PRX45ugPRLn6LA-188" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-186" value="convertLazyLocalAddress(bootstrap);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;懒配置SocketAddress, 默认没用到，暂略&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2120" y="1360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-191" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-188" target="uSWqA2PRX45ugPRLn6LA-190" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-210" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-188" target="uSWqA2PRX45ugPRLn6LA-209" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-188" value="BootstrapHandlers.&lt;b&gt;finalizeHandler&lt;/b&gt;(&lt;br&gt;bootstrap, ops, new ChildObserver(childObs));" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2120" y="1440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-193" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-190" target="uSWqA2PRX45ugPRLn6LA-192" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-48" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="uSWqA2PRX45ugPRLn6LA-190" target="bm2imlQ028U47hNO7TBu-47">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-190" value="ChannelFuture f = bootstrap.bind();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;Tcp服务器bind&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="2120" y="1601" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-195" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-192" target="uSWqA2PRX45ugPRLn6LA-194" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-192" value="DisposableBind disposableServer = new DisposableBind(sink, f, obs, bootstrap);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2120" y="1681" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-197" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-194" target="uSWqA2PRX45ugPRLn6LA-196" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-3" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;rounded=1;" edge="1" parent="1" source="uSWqA2PRX45ugPRLn6LA-194" target="bm2imlQ028U47hNO7TBu-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-194" value="f.&lt;b&gt;addListener&lt;/b&gt;(disposableServer);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;HttpServer bind成功或失败后会回调 operationComplete() 继承自&lt;b&gt;ChannelFutureListener&lt;/b&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2120" y="1761" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="uSWqA2PRX45ugPRLn6LA-196" target="bm2imlQ028U47hNO7TBu-34">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-196" value="sink.onCancel(disposableServer);&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;注册Mono取消的回调方法，&lt;br&gt;只是用于在Mono取消后调用&lt;b&gt;dispose&lt;/b&gt;()释放资源&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2120" y="1899.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-198" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;HttpServer初始化后的实际对象：&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;this = {&lt;b&gt;HttpServerTcpConfig&lt;/b&gt;@2224}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;tcpServerMapper = {HttpServer$lambda@2225}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;source = {&lt;b&gt;HttpServerHandle&lt;/b&gt;@2226}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; handler = {HttpServerTests$lambda@2218}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; source = {&lt;b&gt;HttpServerTcpConfig&lt;/b&gt;@2217}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp;tcpServerMapper = {HttpServer$lambda@2219}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp;source = {&lt;b&gt;HttpServerBind&lt;/b&gt;@2220}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; tcpServer = {TcpServerBind@2180}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;serverBootstrap = {ServerBootstrap@2182}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-440" y="350" width="250" height="130" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-199" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;TcpServer装配后的实际对象：&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;b = {TcpServerBootstrap@2244}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;bootstrapMapper = {HttpServer$lambda@2245}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;source = {TcpServerBootstrap@2242}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; bootstrapMapper = {HttpServerHandle@2234}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; source = {TcpServerBootstrap@2232}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp;bootstrapMapper = {TcpServer$lambda@2233}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp;source = {TcpServerBind@2180}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp; &amp;nbsp; serverBootstrap = {ServerBootstrap@2181}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="-1780" y="360" width="240" height="120" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-200" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.&lt;/font&gt;&lt;font style=&quot;background-color: initial;&quot; color=&quot;#000000&quot;&gt;channel.&lt;/font&gt;&lt;/font&gt;&lt;b style=&quot;color: rgb(0, 0, 0); background-color: initial;&quot;&gt;BootstrapHandlers&lt;/b&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;&quot;&gt;&amp;nbsp;Helper to update configuration the main {@link Bootstrap} and&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;{@link ServerBootstrap} handlers&lt;/span&gt;&lt;br&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp;&lt;/font&gt;&lt;br&gt;&amp;nbsp;//为 ServerBootStrap 初始化配置 ChannelHandler&lt;br&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp;public static void finalizeHandler(ServerBootstrap b, ChannelOperations.OnSetup&lt;/font&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/span&gt;opsFactory, ConnectionObserver childListener)&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp;&lt;/span&gt;//为 Bootstrap 即客户端初始化配置 ChannelHandler&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp;public static void finalizeHandler(Bootstrap b,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp; &amp;nbsp; ChannelOperations.OnSetup opsFactory, ConnectionObserver listener)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp;//&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp;public static void channelOperationFactory(AbstractBootstrap&amp;lt;?, ?&amp;gt; b,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp; &amp;nbsp; ChannelOperations.OnSetup opsFactory)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp;public static ChannelOperations.OnSetup channelOperationFactory(AbstractBootstrap&amp;lt;?, ?&amp;gt; b)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp;public static void connectionObserver(AbstractBootstrap&amp;lt;?, ?&amp;gt; b,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp; &amp;nbsp; ConnectionObserver connectionObserver)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp;public static void childConnectionObserver(ServerBootstrap b,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp; &amp;nbsp; ConnectionObserver connectionObserver)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp;public static Bootstrap updateConfiguration(Bootstrap b, String name,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp; &amp;nbsp; BiConsumer&amp;lt;ConnectionObserver, ? super Channel&amp;gt; c)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp;public static Bootstrap updateLogSupport(Bootstrap b, LoggingHandler handler)&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-480" y="1200" width="440" height="340" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-203" value="读取AbstractBootstrap选项Map中&lt;br&gt;名为&lt;b&gt;connectionObserver&lt;/b&gt;的选项的值" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2360" y="1200" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-205" value="ChannelOperations.OnSetup ops = (ChannelOperations.OnSetup) b.config().options().get(&lt;b&gt;OPS_OPTION&lt;/b&gt;);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="2360" y="1280" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-212" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" parent="1" source="uSWqA2PRX45ugPRLn6LA-209" target="uSWqA2PRX45ugPRLn6LA-211" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-209" value="&lt;font style=&quot;font-size: 9px;&quot;&gt;ChannelHandler handler = b.config().&lt;b&gt;childHandler&lt;/b&gt;();&lt;br&gt;&lt;b&gt;pipeline&lt;/b&gt; = (BootstrapPipelineHandler) handler;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="2360" y="1440" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-211" value="b.&lt;b&gt;childHandler&lt;/b&gt;(new &lt;b&gt;BootstrapInitializerHandler&lt;/b&gt;(pipeline, opsFactory, childListener));" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="2360" y="1520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-213" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.&lt;/font&gt;&lt;font style=&quot;background-color: initial;&quot; color=&quot;#000000&quot;&gt;channel.&lt;/font&gt;&lt;/font&gt;&lt;font style=&quot;background-color: initial;&quot; color=&quot;#000000&quot;&gt;&lt;b&gt;BootstrapHandlers&lt;/b&gt;&lt;/font&gt;&lt;font style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;background-color: initial;&quot; color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;/font&gt;&lt;b style=&quot;background-color: initial; color: rgb(0, 0, 0);&quot;&gt;BootstrapInitializerHandler&amp;nbsp;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;extends ChannelInitializer&amp;lt;Channel&amp;gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;ChannelHandler pipeline 初始化器&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;// 存储待配置的PipelineConfiguration的List容器&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;final &lt;b&gt;BootstrapPipelineHandler&lt;/b&gt; pipeline;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;// 连接状态变更的监听器&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;final ConnectionObserver&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;listener;&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;// OPS_OPTION 配置&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;final ChannelOperations.OnSetup opsFactory;&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fontColor=#007FFF;" parent="1" vertex="1">
          <mxGeometry x="-960" y="1200" width="440" height="160" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-217" value="BootstrapPipelineHandler p = new BootstrapPipelineHandler p = &lt;b&gt;BootstrapPipelineHandler&lt;/b&gt;(&lt;br&gt;Collections.emptyList());" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="1880" y="520" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-219" value="&lt;font color=&quot;#007fff&quot;&gt;将后面创建的 BootstrapPipelineHandler&lt;br&gt;赋值给 ServerBootstrap childHandler&lt;br&gt;&amp;nbsp;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="1400" y="589" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="uSWqA2PRX45ugPRLn6LA-220" value="&lt;font color=&quot;#007fff&quot; style=&quot;font-size: 10px;&quot;&gt;这里对BootstrapPipelineHandler&lt;br&gt;又注册了 &lt;b&gt;Http1Initializer&lt;/b&gt; 这个 Handler&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="2725" y="756" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-1" value="&lt;font color=&quot;#007fff&quot;&gt;MonoCreate 发布者在onSubscribe() &lt;br&gt;触发订阅后，会执行 sink -&amp;gt; {...} 逻辑&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1880" y="1190" width="220" height="40" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-10" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" edge="1" parent="1" source="bm2imlQ028U47hNO7TBu-2" target="bm2imlQ028U47hNO7TBu-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-2" value="TcpServerBind#operationComplete()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;无论成功或失败都会发送信号（序列元素）&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="2360" y="1761" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-5" value="&lt;div&gt;f.&lt;b&gt;removeListener&lt;/b&gt;(this);&lt;/div&gt;&lt;div&gt;if (f.channel().isActive()) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; f.channel().&lt;b&gt;close&lt;/b&gt;();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; HttpResources.get().disposeWhen(&lt;/div&gt;&lt;div&gt;bootstrap.config().localAddress());&lt;/div&gt;&lt;div&gt;} else if (!f.isDone()) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; f.&lt;b&gt;cancel&lt;/b&gt;(true);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;}&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;align=left;arcSize=6;" vertex="1" parent="1">
          <mxGeometry x="2600" y="1880" width="200" height="99" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-12" value="" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;rounded=1;" edge="1" parent="1" source="bm2imlQ028U47hNO7TBu-9" target="bm2imlQ028U47hNO7TBu-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-13" value="失败" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#007FFF;" vertex="1" connectable="0" parent="bm2imlQ028U47hNO7TBu-12">
          <mxGeometry x="-0.25" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-15" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=1;" edge="1" parent="1" source="bm2imlQ028U47hNO7TBu-9" target="bm2imlQ028U47hNO7TBu-14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-16" value="成功" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#007FFF;" vertex="1" connectable="0" parent="bm2imlQ028U47hNO7TBu-15">
          <mxGeometry x="-0.038" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-9" value="!f.isSuccess()" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="2600" y="1751" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-19" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;rounded=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" edge="1" parent="1" source="bm2imlQ028U47hNO7TBu-11" target="uSWqA2PRX45ugPRLn6LA-84">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2940" y="1751" />
              <mxPoint x="2940" y="1030" />
              <mxPoint x="660" y="1030" />
              <mxPoint x="660" y="831" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-11" value="if (f.isCancelled())&amp;nbsp;&lt;br&gt;&amp;nbsp; &amp;nbsp; return;&lt;br&gt;sink.&lt;b&gt;error&lt;/b&gt;(ChannelBindException.fail(&lt;br&gt;bootstrap, f.cause()));" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;align=left;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2720" y="1721" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-18" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fillColor=#dae8fc;strokeColor=#6c8ebf;rounded=1;" edge="1" parent="1" source="bm2imlQ028U47hNO7TBu-14" target="uSWqA2PRX45ugPRLn6LA-84">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2940" y="1830" />
              <mxPoint x="2940" y="1030" />
              <mxPoint x="660" y="1030" />
              <mxPoint x="660" y="831" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-21" value="信号" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="bm2imlQ028U47hNO7TBu-18">
          <mxGeometry x="0.9705" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-14" value="&lt;div&gt;sink.&lt;b&gt;success&lt;/b&gt;(this);&lt;/div&gt;&lt;div&gt;selectorObserver.&lt;b&gt;onStateChange&lt;/b&gt;(this, ConnectionObserver.State.CONNECTED);&lt;span style=&quot;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;this即DisposableBind对象&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;fontSize=10;rounded=1;align=left;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2720" y="1800" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-20" value="&lt;font color=&quot;#007fff&quot;&gt;发送信号&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2950" y="1736" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="bm2imlQ028U47hNO7TBu-22" target="bm2imlQ028U47hNO7TBu-24">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-22" value="关闭HttpServer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;gradientColor=#97d077;" vertex="1" parent="1">
          <mxGeometry x="40" y="1080" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-27" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="bm2imlQ028U47hNO7TBu-24" target="bm2imlQ028U47hNO7TBu-26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-24" value=".disposeNow()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;主动关闭&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="240" y="1080" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-29" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="bm2imlQ028U47hNO7TBu-26" target="bm2imlQ028U47hNO7TBu-28">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-26" value="dispose();&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;关闭通道，释放资源&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="440" y="1080" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-28" value="onDispose().block(timeout);" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="440" y="1160" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-30" value="return FutureMono.from(channel().closeFuture());&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;closeFuture()会等待关闭通道&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="440" y="881" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="bm2imlQ028U47hNO7TBu-34" target="bm2imlQ028U47hNO7TBu-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-34" value="TcpServerBind#&lt;b&gt;dispose&lt;/b&gt;()&lt;br&gt;&lt;font color=&quot;#007fff&quot;&gt;关闭通道，释放Http资源&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2360" y="1899.5" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-41" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="bm2imlQ028U47hNO7TBu-39" target="bm2imlQ028U47hNO7TBu-40">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-39" value="连接事件处理逻辑" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;gradientColor=#97d077;" vertex="1" parent="1">
          <mxGeometry x="40" y="1280" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-52" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="bm2imlQ028U47hNO7TBu-40" target="bm2imlQ028U47hNO7TBu-51">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-40" value="&lt;div&gt;EpollEventLoop#&lt;span style=&quot;background-color: initial;&quot;&gt;run()&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;这里只分析NIO,至于为何走到这，&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#007fff&quot;&gt;参考Netty源码流程图，4.1.43 NioEventLoop改名为了EpollEventLoop&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="240" y="1280" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-42" value="&lt;div style=&quot;text-align: center; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.ConnectionObserver&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;&quot;&gt;此接口是TCP连接（Connection）生命周期的监听器，生命周期的5种状态：&lt;br&gt;&lt;br&gt;//状态改变后回调&lt;br&gt;&lt;font color=&quot;#000000&quot;&gt;void onStateChange(Connection connection, State newState);&lt;/font&gt;&lt;br&gt;//链接另一个ConnectionObserver&lt;br&gt;&lt;font color=&quot;#000000&quot;&gt;ConnectionObserver then(ConnectionObserver other)&lt;/font&gt;&lt;br&gt;&lt;br&gt;//&amp;nbsp;interface State 内部类定义&lt;br&gt;// 连接被建立且可用&lt;br&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;State CONNECTED = ReactorNetty.CONNECTED;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;// 连接被绑定到通道操作并已准备好交互&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;State CONFIGURED = ReactorNetty.CONFIGURED;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;State ACQUIRED = ReactorNetty.ACQUIRED;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;State RELEASED = ReactorNetty.RELEASED;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;State DISCONNECTING = ReactorNetty.DISCONNECTING;&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="-960" y="801" width="440" height="239" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-43" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.&lt;/font&gt;&lt;font style=&quot;background-color: initial;&quot; color=&quot;#000000&quot;&gt;channel.&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;&lt;b&gt;ChannelOperations&lt;/b&gt;&amp;lt;INBOUND extends NettyInbound, OUTBOUND extends NettyOutbound&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;定义响应式的ChannelHandler&lt;/font&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;&lt;br style=&quot;font-size: 10px;&quot;&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;final Connection&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;b&gt;connection&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;final FluxReceive&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;b&gt;inbound&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;final ConnectionObserver&amp;nbsp; &lt;b&gt;listener&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;final MonoProcessor&amp;lt;Void&amp;gt; &lt;b&gt;onTerminate&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;volatile Subscription &lt;b&gt;outboundSubscription&lt;/b&gt;;&lt;/font&gt;&lt;/p&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="-1440" y="800" width="440" height="240" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;endArrow=diamondThin;endFill=1;" edge="1" parent="1" source="bm2imlQ028U47hNO7TBu-44" target="uSWqA2PRX45ugPRLn6LA-213">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-44" value="&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#000000&quot;&gt;reactor.netty.&lt;/font&gt;&lt;font style=&quot;background-color: initial;&quot; color=&quot;#000000&quot;&gt;channel.&lt;/font&gt;&lt;/font&gt;&lt;font style=&quot;background-color: initial;&quot; color=&quot;#000000&quot;&gt;&lt;b&gt;BootstrapHandlers&lt;/b&gt;&lt;/font&gt;&lt;font style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;background-color: initial;&quot; color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;/font&gt;&lt;b style=&quot;color: rgb(0, 0, 0); background-color: initial;&quot;&gt;BootstrapPipelineHandler&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;text-align: center;&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;&amp;nbsp;extends ArrayList&amp;lt;PipelineConfiguration&amp;gt;&amp;nbsp;&lt;/font&gt;&lt;span style=&quot;color: rgb(0, 0, 0); background-color: initial;&quot;&gt;implements ChannelHandler&lt;/span&gt;&lt;/div&gt;&lt;hr style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;是一个List容器，存储PipelineConfiguration&lt;br&gt;&lt;/font&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=10;fontFamily=Helvetica;html=1;fontColor=#007FFF;" vertex="1" parent="1">
          <mxGeometry x="-1360" y="1240" width="360" height="80" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-47" value="&lt;font color=&quot;#007fff&quot;&gt;ServerBootstrap init(Channel channel)&amp;nbsp;&lt;br&gt;阶段将&amp;nbsp;BootstrapPipelineHandler 中的ChannelHandler 添加到 pipeline 链表&lt;br&gt;（责任链模式）&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="2360" y="1601" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-49" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;这步是Netty的源码实现，这里不细讲&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2365" y="1661" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-50" value="&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&lt;b style=&quot;&quot;&gt;绑定后子Channel的pipeline: （这个不是最终的pipeline，连接接入后才会为子Channel生成最终的pipeline）&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;pipeline = {DefaultChannelPipeline@2934}&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp;&lt;b&gt;head&lt;/b&gt; = {DefaultChannelPipeline$&lt;b&gt;HeadContext&lt;/b&gt;@2941}&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &lt;b&gt;next&lt;/b&gt; = {DefaultChannelHandlerContext@3278} &quot;ChannelHandlerContext(ServerBootstrap$&lt;b&gt;ServerBootstrapAcceptor&lt;/b&gt;#0, [id: 0x6bc5b9d7])&quot;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;handler = {ServerBootstrap$ServerBootstrapAcceptor@3282}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; childGroup = {EpollEventLoopGroup@2565}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; childHandler = {BootstrapHandlers$&lt;b&gt;BootstrapInitializerHandler&lt;/b&gt;@2728}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; childOptions = {Map$Entry[2]@3003}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; childAttrs = {Map$Entry[0]@3017}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; enableAutoReadTask = {ServerBootstrap$ServerBootstrapAcceptor$1@3318}&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp; added = true&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 10px;&quot;&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#007fff&quot;&gt;&amp;nbsp; &amp;nbsp;&lt;b style=&quot;&quot;&gt;next&lt;/b&gt; = {DefaultChannelPipeline$&lt;b style=&quot;&quot;&gt;TailContext&lt;/b&gt;@2942}&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="2570" y="1551" width="650" height="160" as="geometry" />
        </mxCell>
        <mxCell id="bm2imlQ028U47hNO7TBu-51" value="&lt;div&gt;NioEventLoop#&lt;/div&gt;&lt;div&gt;processSelectedKeys()&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="440" y="1280" width="200" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
